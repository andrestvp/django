{% extends 'form.html' %}

{% block javascript %}
    <script type="application/javascript">
        //$(function () {
            

            //console.log('xxx');
            //let input_ent = document.getElementById('id_dni');
            //input_ent.value = (nv.toFixed(2));
            //var va_ent = input_ent.value;
            //console.log('xxx', va_ent);



        $('#id_dni').on('change', function() {

            console.log('c');
            //var tot = 0.00


            var e = document.getElementById("id_dni");
            var strent = e.value;
            console.log('entra', strent);

            if(strent.length == 10){
                    
                    //Obtenemos el digito de la region que sonlos dos primeros digitos
                    var digito_region = strent.substring(0,2);
                    
                    //Pregunto si la region existe ecuador se divide en 24 regiones
                    if( digito_region >= 1 && digito_region <=24 ){
                    
                    // Extraigo el ultimo digito
                    var ultimo_digito   = strent.substring(9,10);

                    //Agrupo todos los pares y los sumo
                    var pares = parseInt(strent.substring(1,2)) + parseInt(strent.substring(3,4)) + parseInt(strent.substring(5,6)) + parseInt(strent.substring(7,8));

                    //Agrupo los impares, los multiplico por un factor de 2, si la resultante es > que 9 le restamos el 9 a la resultante
                    var numero1 = strent.substring(0,1);
                    var numero1 = (numero1 * 2);
                    if( numero1 > 9 ){ var numero1 = (numero1 - 9); }

                    var numero3 = strent.substring(2,3);
                    var numero3 = (numero3 * 2);
                    if( numero3 > 9 ){ var numero3 = (numero3 - 9); }

                    var numero5 = strent.substring(4,5);
                    var numero5 = (numero5 * 2);
                    if( numero5 > 9 ){ var numero5 = (numero5 - 9); }

                    var numero7 = strent.substring(6,7);
                    var numero7 = (numero7 * 2);
                    if( numero7 > 9 ){ var numero7 = (numero7 - 9); }

                    var numero9 = strent.substring(8,9);
                    var numero9 = (numero9 * 2);
                    if( numero9 > 9 ){ var numero9 = (numero9 - 9); }

                    var impares = numero1 + numero3 + numero5 + numero7 + numero9;

                    //Suma total
                    var suma_total = (pares + impares);

                    //extraemos el primero digito
                    var primer_digito_suma = String(suma_total).substring(0,1);

                    //Obtenemos la decena inmediata
                    var decena = (parseInt(primer_digito_suma) + 1)  * 10;

                    //Obtenemos la resta de la decena inmediata - la suma_total esto nos da el digito validador
                    var digito_validador = decena - suma_total;

                    //Si el digito validador es = a 10 toma el valor de 0
                    if(digito_validador == 10)
                        var digito_validador = 0;

                    //Validamos que el digito validador sea igual al de la cedula
                    if(digito_validador == ultimo_digito){
                        console.log('la cédula:' + strent + ' es correcta');
                    }else{
                        console.log('la cédula:' + strent + ' es incorrecta');
                        message_error('La cédula: ' + strent + ' es incorrecta');

                    }
                    
                    }else{
                    // imprimimos en consola si la region no pertenece
                    console.log('Esta cédula no pertenece a ninguna region');
                    message_error('Esta cédula no pertenece a ninguna región');
                    }
                }else{
                    //imprimimos en consola si la cedula tiene mas o menos de 10 digitos
                    console.log('Esta cédula tiene menos de 10 Digitos');
                    message_error('Esta cédula tiene menos de 10 Dígitos');
                }    




        });



         $('#id_celular').on('change', function() {

            console.log('c');
            //var tot = 0.00


            var e = document.getElementById("id_celular");
            var strcel = e.value;
            console.log('entra', strcel);

            if(strcel.length != 10){


                message_error('Debe contener 10 dígitos ');

            }



        });
       // });
    </script>
{% endblock %}